generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  email     String?   @unique
  name      String?
  role      String    @default("user")
  password  String
  phone     String    @unique
  createdAt DateTime  @default(now())
  bookings  Booking[]
  fields    Field[]   @relation("OwnerFields")
  notifications Notification[]

  @@index([createdAt])
}

model Club {
  id          String   @id @default(cuid())
  name        String
  nameEn      String?
  logoUrl     String?
  address     String?
  addressEn   String?
  description String?
  descriptionEn String?
  createdAt   DateTime @default(now())
  fields      Field[]
}

model Field {
  id                 String    @id @default(cuid())
  clubId             String?
  name               String
  nameEn             String?
  pricePerHour       Float
  description        String?
  descriptionEn      String?
  address            String?
  addressEn          String?
  area               String?
  lat                Float?
  lng                Float?
  locationUrl        String?
  imageUrl           String?
  imageUrl2          String?
  imageUrl3          String?
  cancellationPolicy String?   @default("No cancellation policy specified.")
  cancellationPolicyEn String?
  ownerId            String?
  createdAt          DateTime  @default(now())
  bookings           Booking[]
  owner              User?     @relation("OwnerFields", fields: [ownerId], references: [id])
  club               Club?     @relation(fields: [clubId], references: [id], onDelete: SetNull)

  @@index([clubId])
  @@index([ownerId])
  @@index([area])
  @@index([createdAt])
}

model Booking {
  id                    String    @id @default(cuid())
  userId                String
  fieldId               String
  startTime             DateTime
  endTime               DateTime
  status                String    @default("PENDING") // PENDING, CONFIRMED, REJECTED, CANCEL_REQUESTED, CANCELLED
  receiptUrl            String?
  serviceFee            Float     @default(10.0)
  totalPrice            Float
  cancellationReason    String?
  refundAmount          Float?
  cancellationAdminNote String?
  isSettled             Boolean   @default(false)
  createdAt             DateTime  @default(now())
  field                 Field     @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  user                  User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([fieldId])
  @@index([status])
  @@index([startTime])
  @@index([isSettled])
}

model GlobalSettings {
  id                 String   @id @default("global")
  serviceFee         Float    @default(10.0)
  adminPhone         String   @default("201009410112")
  whatsappEnabled    Boolean  @default(true)
  whatsappInstanceId String?
  whatsappToken      String?
  emailEnabled       Boolean  @default(false)
  emailApiKey        String?
  emailFromAddress   String?
  updatedAt          DateTime @updatedAt
}

model Notification {
  id        String   @id @default(cuid())
  userId    String?
  title     String
  message   String
  type      String   // BOOKING, FIELD, ANNOUNCEMENT
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
}
